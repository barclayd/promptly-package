---
title: Type Generation
description: Generate typed template variables from your CMS prompts using the codegen CLI.
---

import { Tabs, TabItem, Aside } from '@astrojs/starlight/components';

The `promptly generate` CLI command fetches all your prompts from the API and generates a TypeScript declaration file with typed template variables for every prompt ID.

## Run codegen

<Tabs>
  <TabItem label="bun">
    ```bash
    bunx promptly generate
    ```
  </TabItem>
  <TabItem label="npm">
    ```bash
    npx promptly generate
    ```
  </TabItem>
  <TabItem label="yarn">
    ```bash
    yarn dlx promptly generate
    ```
  </TabItem>
  <TabItem label="pnpm">
    ```bash
    pnpm dlx promptly generate
    ```
  </TabItem>
</Tabs>

This generates a `promptly-env.d.ts` declaration file. The CLI automatically places it in `src/types/` or `types/` if either directory exists in your project, otherwise it falls back to the project root.

## Generated output

The generated file uses [declaration merging](https://www.typescriptlang.org/docs/handbook/declaration-merging.html) to augment the `PromptVariableMap` interface:

```typescript title="promptly-env.d.ts"
// Auto-generated by @promptlycms/prompts — do not edit
import '@promptlycms/prompts';

declare module '@promptlycms/prompts' {
  interface PromptVariableMap {
    'review-prompt': {
      [V in 'latest' | '2.0.0' | '1.0.0']: {
        pickupLocation: string;
        items: string;
      };
    };
    'welcome-email': {
      [V in 'latest' | '1.0.0']: {
        email: string;
        subject: string;
      };
    };
  }
}
```

## What this gives you

With the generated file present, you get:

- **Prompt ID autocomplete** — `getPrompt('` suggests all known prompt IDs
- **Typed template variables** — `result.userMessage({ ... })` only accepts the correct variable keys
- **Version-aware types** — different versions can have different variables, and the types track this
- **Fallback for unknown IDs** — untyped prompt IDs fall back to `Record<string, string>`

### Before codegen

```typescript
// No autocomplete, no type checking on variables
const result = await promptly.getPrompt('review-prompt');
result.userMessage({ anything: 'goes' }); // No error
```

### After codegen

```typescript
// Autocomplete for prompt ID and variables
const result = await promptly.getPrompt('review-prompt');

result.userMessage({
  pickupLocation: 'London', // Typed
  items: 'sofa',            // Typed
});

result.userMessage({
  wrong: 'key', // Type error
});
```

## Output location

By default, the CLI auto-detects the best location for the generated file:

| Priority | Directory | Output path |
|----------|-----------|-------------|
| 1 | `src/types/` exists | `src/types/promptly-env.d.ts` |
| 2 | `types/` exists | `types/promptly-env.d.ts` |
| 3 | Fallback | `./promptly-env.d.ts` |

To override, use the `--output` (`-o`) flag:

```bash
npx promptly generate --output ./custom/path/promptly-env.d.ts
```

## Pass API key directly

If you don't have `PROMPTLY_API_KEY` set in your environment:

```bash
npx promptly generate --api-key pk_live_...
```

## Best practices

<Aside type="tip">
  Commit `promptly-env.d.ts` to version control. This ensures types are available in CI and for teammates without needing to run codegen.
</Aside>

- **Re-run codegen** whenever you add, remove, or rename template variables in the CMS
- **Commit the generated file** so types are available without running codegen
- **Add to your build script** if you want to always regenerate on deploy

## How it works

Under the hood, `promptly generate`:

1. Reads `PROMPTLY_API_KEY` from the environment (or `--api-key` flag)
2. Calls `GET /prompts?include_versions=true` to fetch all prompts
3. Extracts `${variable}` template patterns from each prompt's `userMessage`
4. Groups versions with identical variables together
5. Writes a `declare module '@promptlycms/prompts'` augmentation file

The `PromptVariableMap` interface is intentionally empty in the source package — it exists only as a declaration merging target. This is the same pattern used by Prisma and GraphQL Code Generator.

## Next steps

- Learn about [fetching prompts](/guides/fetching-prompts/) with typed results
- See the full [CLI reference](/reference/cli/) for all flags
